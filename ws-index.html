<!DOCTYPE>
<html>
<head>
    <title>Sample test</title>
    <script type="text/javascript" src="/static/jquery-1.4.2.min.js"></script>
	<script type="text/javascript" src="/static/Three.js"></script>
	<style>
		ul#log {
			-webkit-perspective: 600;
			-webkit-transition: -webkit-transform 1s;
		}
		ul#log li {
			-webkit-transform: rotateY(45deg);
		}

	</style>
</head>
<body>
    <h1>Hello world!</h1>
    <form method='POST' action='./'>
        <input type="text" name='data' id="data" />
        <div><input type='submit'></div>
    </form>
    <ul id="log">
    	{% for message in messages %}
         	<li>{{ message }}</li>
      	{% end %}
    </ul>
    <script type="text/javascript" charset="utf-8">
        $(document).ready(function(){
            
            $('form').submit(function(event){
                var value = $('#data').val();
                $.post("./", { data: value }, function(data){
                    $("#data").val('');
                });
                return false;
            });
            
            if ("WebSocket" in window) {
              var ws = new WebSocket("ws://127.0.0.1:8888/realtime/");
              ws.onopen = function() {console.log("opened ws")};
              ws.onmessage = function (evt) {
				  console.log("in onmessage");
                  var received_msg = evt.data;
                  var html = $("#log").html();
                  html += "<li>"+received_msg+"</li>";
                  $("#log").html(html);
              };
			  ws.onerror = function() {console.log("error")};
              ws.onclose = function() {console.log("closed ws")};
            } else {
              alert("WebSocket not supported");
            }
        });
    </script>
</body>
</html>